import{a as L}from"/build/_shared/chunk-6KU7KB65.js";import{a as y,b as v,c as g,d as w,e as C,f as T,g as B,h as F,i as R,j as q,k as U}from"/build/_shared/chunk-PLAFFANM.js";import{b as n}from"/build/_shared/chunk-6NL3JN34.js";import{a as k}from"/build/_shared/chunk-KTYYHXXO.js";import{a as K,f as h}from"/build/_shared/chunk-57Q5BGZR.js";import"/build/_shared/chunk-HB276KJY.js";import{a as J,c as A,j as E,n as D}from"/build/_shared/chunk-JP2RFOQ7.js";import{d as m}from"/build/_shared/chunk-G5WX4PPA.js";var j=m(K(),1);var d=m(J(),1);var H="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var M=(o=21)=>{let s="",i=crypto.getRandomValues(new Uint8Array(o));for(;o--;)s+=H[i[o]&63];return s};var e=m(D(),1);function I(){let{user:o,sharedCycles:s}=E(),i=A(),{toast:a}=k(),[c,l]=(0,d.useState)(!1),[x,b]=(0,d.useState)(null),[p,N]=(0,d.useState)(""),[V,S]=(0,d.useState)(!1),Y=async()=>{try{l(!0),b(null);let{data:r,error:t}=await h.from("profiles").select("id").eq("email",p).single();if(t)throw new Error("User not found. Make sure they have an account.");let u=M(10),f=new Date;f.setDate(f.getDate()+1);let{error:_}=await h.from("shared_cycles").insert([{user_id:o.id,shared_with_id:r.id,share_code:u,expires_at:f.toISOString()}]);if(_)throw _;a({title:"Share created",description:"Your cycle information has been shared successfully."}),N(""),i(0)}catch(r){let t=r instanceof Error?r.message:"Failed to share cycle";b(t),a({variant:"destructive",title:"Error",description:t})}finally{l(!1)}},O=async r=>{try{await navigator.clipboard.writeText(r),S(!0),setTimeout(()=>S(!1),2e3),a({title:"Code copied",description:"Share code has been copied to clipboard."})}catch{a({variant:"destructive",title:"Error",description:"Failed to copy code to clipboard."})}},G=async r=>{try{l(!0);let{error:t}=await h.from("shared_cycles").delete().eq("id",r);if(t)throw t;a({title:"Share removed",description:"Access has been revoked successfully."}),i(0)}catch(t){let u=t instanceof Error?t.message:"Failed to remove share";a({variant:"destructive",title:"Error",description:u})}finally{l(!1)}};return(0,e.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,e.jsx)("header",{className:"border-b",children:(0,e.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,e.jsxs)("div",{className:"flex items-center gap-4",children:[(0,e.jsx)(n,{variant:"ghost",size:"icon",onClick:()=>i("/dashboard"),children:(0,e.jsx)(F,{className:"h-4 w-4"})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{className:"text-2xl font-bold",children:"Share Cycle"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:"Share your cycle with trusted partners"})]})]})})}),(0,e.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,e.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,e.jsxs)(y,{children:[(0,e.jsxs)(v,{children:[(0,e.jsx)(g,{children:"Share with Someone"}),(0,e.jsx)(w,{children:"Enter their email to share your cycle information"})]}),(0,e.jsxs)(C,{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(L,{type:"email",placeholder:"Enter email address",value:p,onChange:r=>N(r.target.value),disabled:c}),(0,e.jsxs)(n,{onClick:Y,disabled:c||!p,children:[c&&(0,e.jsx)(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Share"]})]}),x&&(0,e.jsx)(T,{variant:"destructive",children:(0,e.jsx)(B,{children:x})})]})]}),(0,e.jsxs)(y,{children:[(0,e.jsxs)(v,{children:[(0,e.jsx)(g,{children:"Active Shares"}),(0,e.jsx)(w,{children:"Manage who has access to your cycle information"})]}),(0,e.jsx)(C,{children:s.length===0?(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:"You haven't shared your cycle with anyone yet"}):(0,e.jsx)("div",{className:"space-y-4",children:s.map(r=>(0,e.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"font-medium",children:r.shared_with.email}),(0,e.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Expires: ",new Date(r.expires_at).toLocaleDateString()]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(n,{variant:"outline",size:"icon",onClick:()=>O(r.share_code),children:V?(0,e.jsx)(R,{className:"h-4 w-4"}):(0,e.jsx)(q,{className:"h-4 w-4"})}),(0,e.jsx)(n,{variant:"destructive",onClick:()=>G(r.id),disabled:c,children:"Remove"})]})]},r.id))})})]})]})})]})}export{I as default};
